language: rust
cache: cargo
rust:
  - 1.41.0
  - stable
  - beta
jobs:
  include:
    - name: "Minimal versions"
      rust: 1.41.0
      env: TEST_MINIMAL_VERSIONS=1
    - name: "Lint"
      rust: 1.41.0
      before_install: |
        rustup component add clippy rustfmt
        cargo clippy --version
        cargo fmt --version
      script:
        # Fail if the code is correctly formatted.
        - cargo fmt --all -- --check
        # Fail if the code has warnings.
        - cargo clippy --all-features -- --deny warnings
    - name: "stable, nostd"
      rust: stable
      script:
        - cargo build --verbose --workspace --no-default-features && cargo test --verbose --workspace --no-default-features
    - name: "stable, alloc"
      rust: stable
      script:
        - cargo build --verbose --workspace --no-default-features --features=alloc && cargo test --verbose --workspace --no-default-features --features=alloc
before_install:
  - |
    if [ "${TEST_MINIMAL_VERSIONS:-0}" -ne 0 ] ; then
        rustup install nightly
    fi
before_script:
  # Use dependencies with minimal versions.
  - |
    if [ "${TEST_MINIMAL_VERSIONS:-0}" -ne 0 ] ; then
        cargo +nightly update -Z minimal-versions
    fi
script:
  - cargo build --verbose --workspace --all-features && cargo test --verbose --workspace --all-features
notifications:
  email: false
